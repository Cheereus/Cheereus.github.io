---
layout:     post
title:      单细胞聚类方法调研
subtitle:   Review of Single Cell Clustering
date:       2020-02-22
author:     Cheereus
header-img: img/post-bg-debug.png
catalog: true
tags:
    - 读研
    - 单细胞聚类
---

## 单细胞聚类方法调研

背景略。

首先从无监督学习和监督学习两个大方向进行每个方法的分别介绍，然后从流程上根据是否对原始数据进行降维、去噪和dropout等预处理操作来进行进一步分类讨论和总结。

### SNN-Cliq <sup>[3]</sup>

首先构建 SNN 图。

首先使用欧氏距离(其他距离计算方法亦可)计算成对数据点之间的相似矩阵。

然后，对于每个数据点 $x_i$，根据相似矩阵列出 $k$ 最近邻居表，$x_i$ 本身作为其中的第一个。

构建 SNN 图：对于一对至少有一个共享 KNN 的数据点 $x_i,x_j$，指定一条边 $e(x_i,x_j)$，这条边的权值定义为 $k$ 与共同 KNN 的最高平均排名的差：

$$v(x_i,x_j)=\max\{k-\frac{1}{2}(rank(v,x_i)+rank(v,x_j))\vert v\in NN(x_i)\cap NN(x_j)\}$$

其中 $k$ 为最近邻表的大小，$rank(v,x_i)$ 表示节点 $v$ 在 $x_i$ 的最近邻表 $NN(x_i)$ 中的排名(排名以第 1 名为最近)。

共享最近邻的排名相比于其他普通相似度计算方法的优点是在高维空间中依然具有其意义。而且 SNN 图通常是稀疏的，有利于应用到大数据集上。

然后识别 SNN 图中的类。

最大集团是一个完整(完全连接)的子图且不包括在更大的集团中。尽管枚举出所有的最大集团是一个 NP 难的问题，但每个节点所相关的最大集团可以用启发式的方法有效地找到。

然而由于 SNN 图的一般稀疏性，集团是罕见的。我们寻找伪集团来取而代之，伪集团足够密集但不一定完整(完全连接)。寻找与每个节点相关的伪集团使用贪心算法来实现：

(1) 对于由节点 $v$ 构造的子图 $S$ (包括 $v$ 及其所有邻居节点和相关的边)中的每一个节点 $s$，计算一个局部的度量 $d$ 为从 $S$ 中其他节点入射到 $s$ 的边数。

(2) 在 $S$ 中选取具有最小 $d$ 值 $d_i$ 的节点 $s_i$，如果 $\frac{d_i}{\vert S\vert}<r$($\vert S\vert$ 为 $S$ 中的节点总数，$r$ 为预定义的阈值，$0<r\leq 1$)，将其从 $S$ 中去除。

(3) 更新 $d$ 值，并重复步 (2) 直到没有节点会被去除，如果此时 $\vert S \vert \geq 3$ 即剩下的 $S$ 中至少有三个节点，则称此时的 $S$ 为伪集团。

(4) 找出所有的伪集团后，要对结果进行去冗余，即删除所有完全包含在其他伪集团中的结果。

参数 $r$ 定义了结果中各伪集团的连接度，高的 $r$ 值表示各子图更为紧凑，经过测试，发现 $r=0.7$ 时有比较好的效果。

然后对于任意两个子图 $S_i$ 和 $S_j$，定义一个重叠指数 $O_{i,j}$：

$$O_{i, j}=\frac{\left\vert S_{i} \cap S_{j}\right\vert }{\min \left(\left\vert S_{i}\right\vert ,\left\vert S_{j}\right\vert \right)}$$

如果重叠指数大于预定义的阈值 $0<m\leq 1$ 则将 $S_i$ 和 $S_j$ 合并。重复此操作直到没有子图能被合并为止，则此时剩下的子图即为我们所识别出来的类。

由于一个子图可能和多个子图重叠，从而有不同的合并顺序导致不同结果。为避免此情况，本方法对于有最大总大小 $\vert S_i\vert + \vert S_j \vert$ 的子图对给予高优先级。

上述过程所生成的类中依然会有重叠的部分，为了解决聚类过程中节点所属类别的唯一性问题，对于每个候选类别 $C$ 和目标节点 $v$ 定义一个接近度指标 $\text{Score}(C,v)$，由从 $C$ 中的节点入射到 $v$ 的边上的平均权重计算而来：

$$\text { Score }(C, v)=\frac{1}{\vert C \vert} \sum_{i=1}^{\vert C \vert} w\left(c_{i}, v\right)$$

其中 $c_i$ 是 $C$ 中的一个点。然后将节点 $v$ 分入具有最大 $\text{Score}$ 值的类中，并将其从其他类中去除。这种做法会改变类的组成，且有可能会产生少于三个节点的类，这种较少数目的类被看做孤点，但在本文的应用条件中，未出现这种情况。

### Corr 差异相关系数方法 <sup>[2]</sup>

本方法未进行原始数据的预处理，核心思想在于新定义了一个体现成对细胞间相似性的差异相关系数(differentiability correlation)。

假设具有 $p$ 个基因表达量的 $n$ 个细胞数据，其第 $i$ 个细胞的基因表达情况表示为向量：

$$X_i=(x_{i1},x_{i2},\cdots,x_{ip}),\ i=1,2,\cdots,n$$

对于两个细胞 $i$ 和 $j$，定义两个基因集合 $V_{i_j}^+$ 和 $V_{i_j}^-$，其中 $V_{i_j}^+$ 表示细胞 $i$ 中表达水平高于除了细胞 $j$ 以外其他所有细胞的平均水平的基因， $V_{i_j}^-$ 则表示细胞 $i$ 中表达水平低于除了细胞 $j$ 以外其他所有细胞的平均水平的基因，即：

$$\mathbf{V}_{i_{j} }^{+}=\left\{k \vert  x_{i k}>\frac{\left(\sum_{l=1}^{n} x_{l k}\right)-x_{i k}-x_{j k} }{n-2}\right\}$$

$$\mathbf{V}_{i_{j} }^{-}=\left\{k \vert  x_{i k}<\frac{\left(\sum_{l=1}^{n} x_{l k}\right)-x_{i k}-x_{j k} }{n-2}\right\}$$

使用上述的 $V_{i_j}^+$ 和 $V_{i_j}^-$ 来给细胞 $i$ 中的基因 $k$ 定义差异状态，其规则为：

$$U_{i_{j} k}=\left\{\begin{array}{ll}
{1,} & {k \in V_{i_{j} }^{+} } \\
{-1,} & {k \in V_{i_{j} }^{-} } \\
{0,} & {\text { otherwise } }
\end{array}\right.$$

同理可以定义出细胞 $j$ 中基因 $k$ 的差异状态 $U_{j_{i} k}, k=1, \ldots, p$。于是可以定义细胞 $i$ 和细胞 $j$ 之间的不相似度：

$$S_{i j}=1-\frac{\sum_{k=1}^{p}\left(U_{i_{j} k}-\overline{U_{i_{j} }}\right)\left(U_{j_{i} k}-\overline{U_{j_{i} }}\right)}{\sqrt{\sum_{k=1}^{p}\left(U_{i_{j} k}-\overline{U_{i_{j} }}\right)^{2} } \sqrt{\sum_{k=1}^{p}\left(U_{j_{i} k}-\overline{U_{j_{i} }}\right)^{2} }}$$

其中

$$\overline{U_{i_{j} }}=\sum_{k=1}^{p} U_{i_{j} k} / p,\ \overline{U_{j_{i} }}=\sum_{k=1}^{p} U_{j_{i} k} / p$$

那么差异相关系数 $\left(1-S_{i j}\right)$ 则可以表示细胞 $i$ 和细胞 $j$ 之间相对于其他细胞的差异的相关性，并以此作为距离来进行层次聚类。

### 参考文献

[1] Kiselev, V. Y., Andrews, T. S., & Hemberg, M. (2019). Challenges in unsupervised clustering of single-cell RNA-seq data. Nature Reviews Genetics, 20(5), 273–282. <https://doi.org/10.1038/s41576-018-0088-9>

[2] Jiang, H., Sohn, L. L., Huang, H., & Chen, L. (2018). Single cell clustering based on cell-pair differentiability correlation and variance analysis. Bioinformatics. <https://doi.org/10.1093/bioinformatics/bty390/4996592>

[3] Xu, C., & Su, Z. (2015). Identification of cell types from single-cell transcriptomes using a novel clustering method. Bioinformatics, 31(12), 1974–1980. <https://doi.org/10.1093/bioinformatics/btv088>
